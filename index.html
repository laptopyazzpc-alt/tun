<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gesture + Efek Darah Dramatis</title>
<style>
  body {
    margin:0; overflow:hidden; background:#000;
    display:flex; justify-content:center; align-items:center;
    height:100vh; font-family: Arial, sans-serif;
    color:white;
  }
  canvas { position:absolute; top:0; left:0; }
  video { display:none; }

  /* ========== START SCREEN ========== */
  #startScreen {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:linear-gradient(160deg, #000000, #220000, #440000);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:20;
  }
  #startScreen img {
    width:150px;
    height:150px;
    border-radius:50%;
    object-fit:cover;
    margin-bottom:20px;
    box-shadow:0 0 30px rgba(255,0,0,0.6);
  }
  #username {
    padding:10px 16px;
    border-radius:10px;
    border:none;
    font-size:16px;
    margin-bottom:20px;
    outline:none;
    text-align:center;
  }
  #startBtn {
    padding:12px 30px;
    font-size:20px;
    cursor:pointer;
    border:none;
    border-radius:12px;
    background:linear-gradient(135deg,#ff0000,#660000);
    color:white;
    font-weight:bold;
    box-shadow:0 0 20px rgba(255,0,0,0.7);
    transition:0.3s;
  }
  #startBtn:hover {
    transform:scale(1.05);
    box-shadow:0 0 30px rgba(255,0,0,0.9);
  }

  /* ========== WATERMARK + STATUS ========== */
  #watermark {
    position:absolute;
    top:20px;
    right:30px;
    font-size:22px;
    color:#fff;
    font-weight:bold;
    text-shadow:0 0 10px red;
    z-index:5;
  }
  #status {
    position:absolute;
    bottom:15px;
    left:20px;
    color:#0f0;
    font-size:16px;
    font-family:monospace;
    background:rgba(0,0,0,0.6);
    padding:6px 12px;
    border-radius:8px;
    box-shadow:0 0 10px rgba(0,255,0,0.6);
    z-index:5;
  }
</style>
</head>
<body>

<!-- START SCREEN -->
<div id="startScreen">
  <img src="https://i.ibb.co/5n1h5Vh/user.jpg" alt="Foto User"> <!-- ganti link dengan foto kamu -->
  <input type="text" id="username" placeholder="Masukkan nama Anda">
  <button id="startBtn">Mulai</button>
</div>

<!-- WATERMARK + STATUS -->
<div id="watermark">@bara</div>
<div id="status">Status: standby...</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const statusBox = document.getElementById('status');
const usernameInput = document.getElementById('username');
const watermark = document.getElementById('watermark');
const startScreen = document.getElementById('startScreen');

let lastSpeechTime = 0;
const cooldown = 2000;

// Web Speech API
const synth = window.speechSynthesis;
function speak(text){
    if(!synth.speaking){
        const utter = new SpeechSynthesisUtterance(text);
        utter.rate = 1;
        utter.pitch = 1;
        synth.speak(utter);
    }
}

// Update status box
function setStatus(text,color="#0f0"){
    statusBox.textContent = "Status: " + text;
    statusBox.style.color = color;
}

// Start button
startBtn.addEventListener('click', async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;

    video.addEventListener('loadeddata', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        detectHands();
    });

    // update watermark sesuai nama
    const name = usernameInput.value.trim() || "bara";
    watermark.textContent = "@" + name;

    speak("Sistem siap!");
    setStatus("Sistem siap!", "#0f0");

    // Hilangkan start screen
    startScreen.style.display = 'none';
});

// MediaPipe Hands
const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
hands.setOptions({
    maxNumHands: 2,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
});

// Efek garis darah
function drawBloodLines(landmarks){
    const connections = [
        [0,1],[1,2],[2,3],[3,4],
        [0,5],[5,6],[6,7],[7,8],
        [0,9],[9,10],[10,11],[11,12],
        [0,13],[13,14],[14,15],[15,16],
        [0,17],[17,18],[18,19],[19,20]
    ];

    connections.forEach(([i,j]) => {
        const x1 = canvas.width - landmarks[i].x * canvas.width;
        const y1 = landmarks[i].y * canvas.height;
        const x2 = canvas.width - landmarks[j].x * canvas.width;
        const y2 = landmarks[j].y * canvas.height;
        const mx = (x1 + x2)/2 + (Math.random()-0.5)*6;
        const my = (y1 + y2)/2 + (Math.random()-0.5)*6;

        ctx.strokeStyle = "white";
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.quadraticCurveTo(mx,my,x2,y2);
        ctx.stroke();

        ctx.strokeStyle = "red";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.quadraticCurveTo(mx,my,x2,y2);
        ctx.stroke();
    });
}

// Status jari
function getFingers(landmarks){
    const thumb = landmarks[4].x < landmarks[3].x ? 1 : 0;
    const fingers = [8,12,16,20].map(i => landmarks[i].y < landmarks[i-2].y ? 1 : 0);
    return [thumb,...fingers];
}

// Gesture detect
function detectGesture(handLabel, fingers){
    const now = Date.now();
    if(now - lastSpeechTime < cooldown) return;

    let msg = null;

    if(handLabel==="Right" && fingers.every(f=>f===1)){
        msg="Halo";
    } else if(handLabel==="Right" && fingers[1]==1 && fingers.slice(0,1).concat(fingers.slice(2)).every(f=>f===0)){
        msg="Nama saya";
    } else if(handLabel==="Right" && fingers[0]==1 && fingers.slice(1).every(f=>f===0)){
        const name = usernameInput.value.trim() || "Bara";
        msg=name;
    } else if(handLabel==="Right" && fingers[1]==1 && fingers[2]==1 && fingers[0]==0 && fingers[3]==0 && fingers[4]==0){
        msg="Sampai jumpa";
    } else if(handLabel==="Left" && fingers[0]==0 && fingers.slice(1).every(f=>f===1)){
        msg="Love you";
    }

    if(msg){
        speak(msg);
        setStatus("Gesture: " + msg, "#ff0");
        lastSpeechTime = now;
    }
}

// Hasil deteksi
hands.onResults(results => {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(video.readyState >= 2){
        ctx.save();
        ctx.scale(-1,1);
        ctx.drawImage(video,-canvas.width,0,canvas.width,canvas.height);
        ctx.restore();
    }

    if(results.multiHandLandmarks && results.multiHandedness){
        results.multiHandLandmarks.forEach((landmarks,index)=>{
            drawBloodLines(landmarks);
            const fingers = getFingers(landmarks);
            const handLabel = results.multiHandedness[index].label;
            detectGesture(handLabel,fingers);
        });
    }
});

// Loop
async function detectHands(){
    if(video.readyState >= 2){
        await hands.send({image: video});
    }
    requestAnimationFrame(detectHands);
}
</script>
</body>
</html>
